алгоритм построения дерева нашли. теперь оптимизация